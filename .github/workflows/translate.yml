# .github/workflows/translate.yml
name: 繁体转简体翻译工具          # ← 这里就是你在 Actions 页面看到的名字！

on:
  workflow_dispatch:                # 手动触发（Actions 页面点 Run workflow）

jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4

      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          else
            pip install opencc-python-reimplemented
          fi
          # 如果你以后要转 PDF，可以取消下面这行的注释
          # pip install pdfplumber

      - name: 执行翻译（单个文件示例）
        run: |
          echo "开始翻译..."
          python converter.py requirements.txt translated_output.txt
          echo ""
          echo "翻译完成！文件内容预览："
          cat translated_output.txt

      - name: 执行翻译（Android strings.xml 示例）
        run: |
          # 如果你放的是 strings.xml，就用这行（自行改路径）
          # python converter.py strings.xml values-zh-rCN/strings.xml
          echo "示例命令已就绪，可自行取消注释运行"

      - name: 上传翻译结果为 Artifact（方便下载查看）
        uses: actions/upload-artifact@v4
        with:
          name: 翻译后的文件
          path: |
            translated_output.txt
            *.xml
            *_simplified.*

      - name: 自动提交翻译结果回仓库（可选，推荐开启）
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add translated_output.txt values-zh-rCN/ *_simplified.* 2>/dev/null || echo "无新文件"
          git diff --staged --quiet || git commit -m "Auto: 繁体转简体翻译结果 [skip ci]"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
