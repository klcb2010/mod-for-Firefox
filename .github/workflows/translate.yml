# .github/workflows/translate.yml
name: 繁体转简体

on:
  workflow_dispatch:   # 手动触发

# 关键：给 GITHUB_TOKEN 写权限，解决所有 403
permissions:
  contents: write

jobs:
  convert-and-save:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取仓库代码
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安装 opencc
        run: pip install opencc-python-reimplemented

      - name: 执行翻译：input.txt → output.txt
        run: |
          echo "正在翻译 input.txt ..."
          python converter.py input.txt output.txt
          echo "翻译完成！"
          echo "========== output.txt 内容预览 =========="
          cat output.txt

      - name: 自动提交 output.txt 到仓库根目录
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add output.txt
          git commit -m "Auto: 繁体转简体完成 → output.txt（$(date +'%Y-%m-%d %H:%M')）" || echo "无变化，跳过提交"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: 上传 Artifact（可随时下载）
        uses: actions/upload-artifact@v4
        with:
          name: 翻译结果-output.txt
          path: output.txt
